module main

import std.containers as containers;
import std.iter as iter;
use trait iter.SinglePassIterator;

fn run() -> Int {
	var m = containers.tree_map_new<type Int, Int>();
	m.insert(5, 50);
	m.insert(3, 30);
	m.insert(7, 70);
	m.insert(2, 20);
	m.insert(4, 40);
	m.insert(6, 60);
	m.insert(8, 80);
	val expected = [2, 3, 4, 5, 6, 7, 8];
	var it = m.iter();
	var idx = 0;
	var done = false;
	while not done {
		val nxt = it.next();
		match nxt {
			None => { done = true; },
			Some(item) => {
				if idx >= expected.len {
					return 1;
				}
				val want: Int = expected[idx];
				if *item.key != want {
					return 2;
				}
				idx = idx + 1;
			}
		}
	}
	if idx != expected.len {
		return 3;
	}
	return 0;
}

fn main() nothrow -> Int {
	return try run() catch { 99 };
}
