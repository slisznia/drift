module main

import std.concurrent as conc;
import lang.thread as thread;

fn main() nothrow -> Int {
	var g = conc.future_group<type Int>();
	var f1 = conc.spawn_future(| | => { thread.vt_park_until(10); return 3; });
	var f2 = conc.spawn_future(| | => { thread.vt_park_until(20); return 5; });
	g.add(move f1);
	g.add(move f2);
	var any = g.join_any();
	var all = g.join_all();
	var a = match any {
		Ok(v) => { v },
		Err(_e) => { 0 },
		default => { 0 },
	};
	var sum = match all {
		Ok(vs) => { vs[0] + vs[1] },
		Err(_e) => { 0 },
		default => { 0 },
	};
	return a + sum;
}
