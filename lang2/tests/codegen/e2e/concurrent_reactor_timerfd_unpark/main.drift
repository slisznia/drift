module m

import std.concurrent as conc;
import lang.thread as thread;

pub fn main() nothrow -> Int {
	var t = conc.spawn(| | nothrow => {
		val fd = thread.test_timerfd_create();
		var vt = thread.vt_current();
		val deadline = thread.now_ms() + 10;
		thread.reactor_register_io(fd, 1, vt, deadline);
		thread.test_timerfd_set(fd, 10);
		thread.vt_park(0);
		return 5;
	});
	var res = t.join();
	match res {
		Ok(v) => { return v; },
		Err(_) => { return 1; },
		default => { return 2; }
	}
}
