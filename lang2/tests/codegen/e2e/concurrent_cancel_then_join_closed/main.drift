module main

import std.concurrent as conc;

fn main() nothrow -> Int {
	var t = conc.spawn(| | => { return 1; });
	t.cancel();
	var res1 = t.join();
	var ok1 = match res1 {
		Err(err) => { match err { Cancelled => { true }, default => { false } } },
		Ok(_v) => { false },
		default => { false },
	};
	if not ok1 {
		return 2;
	}
	var res2 = t.join();
	return match res2 {
		Err(err) => {
			match err { Closed => { 0 }, default => { 3 } }
		},
		Ok(_v) => { 4 },
		default => { 4 },
	};
}
