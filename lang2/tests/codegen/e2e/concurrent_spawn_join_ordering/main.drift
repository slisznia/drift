module m

import std.concurrent as conc;
import std.core as core;

pub fn main() nothrow -> Int {
	var t1 = conc.spawn_cb(core.callback0(| | nothrow => { return 1; }));
	var t2 = conc.spawn_cb(core.callback0(| | nothrow => { return 2; }));
	var t3 = conc.spawn_cb(core.callback0(| | nothrow => { return 3; }));
	var a = t3.join();
	var b = t2.join();
	var c = t1.join();
	var sum = 0;
	match a {
		Ok(v) => { sum = sum + v; },
		Err(_) => { return 1; },
		default => { return 2; }
	}
	match b {
		Ok(v) => { sum = sum + v; },
		Err(_) => { return 3; },
		default => { return 4; }
	}
	match c {
		Ok(v) => { sum = sum + v; },
		Err(_) => { return 5; },
		default => { return 6; }
	}
	return sum;
}
